# 創薬初心者向け 解説ドキュメント（explain.md）

この文書は、`app.py` と `README.md` をもとに、創薬の初心者でも本アプリの目的・使い方・業務での活用ポイントが分かるように解説したものです。

## このアプリでできること（ひとことで）
- AIで分子候補を自動生成（E(3)等変性のグラフ拡散モデル）
- 分子の基本的な性質を推定・可視化（RDKit）
- 量子計算で安定性の指標（エネルギー等）を評価（Qiskit VQE、PySCF）
- これらを Streamlit の画面で直観的に操作・確認できます

## なぜ創薬に役立つのか
- 仮説生成のスピードアップ: 多様な分子案を短時間で準備
- 早期フィルタリング: 3D構造や簡易指標で見込み薄を初期除外
- 多様性確保→ベスト選抜: 複数生成から上位候補のみ下流へ
- 検討サイクル短縮に寄与: 生成→簡易評価→次の仮説の回転が速くなる

## 典型的な業務フロー（どこで使う？）
1. 研究テーマ・標的設定（別工程）
2. 本アプリで分子候補を多数生成（多様性重視）
3. 2D/3Dで形を素早く確認、基本プロパティをチェック
4. VQEでエネルギー指標などを確認（参考値）
5. 有望な候補だけをドッキング・合成検討・実験へ
6. フィードバックを反映し、再度生成・評価のループ

## 画面構成と使い方（現状のUI）
### サイドバー（Generation Settings）
- Number of samples: 目標生成数（1〜24）。到達で自動停止
- Sampling seed: 乱数シード（再現性の制御）
- Use Active Space (VQE) / Active Electrons / Active Orbitals / Basis Set: 量子計算設定（既定値でOK）

### 分子生成（ストリーミング）
- Start Streaming / Clear ボタン
- 生成中は `Streaming SMILES` に1件ずつ追加、重複は除外。指定数で自動停止
- 停止後、`Candidates (SMILES)` がちょうど n 件で表示
- オプション: 🎭 3D拡散可視化（複数分子アニメーション）

### 可視化
- 🧪 3D分子マトリクス (静的表示): 格子状に3D表示（py3Dmol）。表示数スライダ対応
- 🧮 化学式マトリクス: 各分子の化学式をグリッド表示

### Inspect & Prepare（RDKit）
- `Pick one molecule` で1つ選択（または SMILES 入力）
- 2D/3D表示と基本プロパティ（Drug-like quick props）
- Download: SDF（常時）/ MOL2（環境によりフォールバック）

### Quantum Chemistry（Qiskit Nature VQE）
- H2分子でのテスト計算が可能（疎通確認）
- ストリーミング生成中は VQE を一時停止（停止後に実行）
- 出力: VQE Energy / Reference / Abs Error、HOMO/LUMO/GAP、Dipole、収束曲線

## 出力の読み方（初心者向けの目安）
- SMILES: 分子を文字列で表す形式。`Candidates (SMILES)` に n 件
- 3D表示: 立体障害・形状の直観確認（定量ではない）
- HOMO/LUMO/GAP: ギャップ小→反応性高の傾向（不安定化もあり得る）
- Dipole: 大きいほど極性が高く水溶性寄り（膜透過は下がる場合）
- VQE Energy: 基底状態エネルギーの参考値（相対比較を推奨）

## 技術のしくみ（やさしい解説）
- E(3)-等変性拡散モデル（グラフ拡散）
  - 3D回転・並進に依らず一貫した表現を保ち、ノイズから3D構造を生成
  - 複数サンプルを一気に出すことで、多様性確保とベスト選抜がしやすい
- RDKit: 分子の2D/3D変換・化学式・簡易物性の計算と描画
- Qiskit Nature + PySCF（VQE）: 量子計算でエネルギー等を評価（下流判断の補強）

## 活用シナリオ例
- ヒット探索初期: 8〜24件生成→上位候補のみ下流へ
- 骨格最適化: 置換案を多数出し、形と基礎物性を快速確認
- 前処理高速化: 重いドッキングやQM/MM前に見込み薄を除外

## 制約と注意
- 本アプリは仮説生成・初期評価の補助。実験や厳密計算の代替ではない
- VQEは設定・収束に依存。相対比較の目安として活用
- 生成は確率的。同じ結果になるとは限らない（Seed固定で再現性向上）

## よくある質問（FAQ）
- 生成数が n と一致しない？→ 自動停止・表示トリム、重複排除とフォールバックで揃えます
- ストリーミングが止まらない/止まる？→ 「Clear→Start Streaming」で再試行。再現時は設定と画面メッセージを記録
- Active Electrons/Orbitals を変えると重い？→ ストリーミング中は VQE を停止。停止後に計算します
- MOL2 が出ない？→ 環境により RDKit の writer 非対応。SDF を優先

## はじめの一歩（最短手順）
1. `streamlit run app.py` を実行し、`http://localhost:8501` を開く
2. サイドバーで `Number of samples = 8` を設定
3. 「Start Streaming」を押して 8 件揃うまで待つ
4. 気になる候補を選び、2D/3D とプロパティを確認
5. 必要に応じて VQE を実行（まずは H2 テスト推奨）
